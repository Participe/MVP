{% extends 'challenge_base.html' %}
{% load i18n %}

{% block title %}{% trans "Edit challenge" %} - {{ block.super }}{% endblock %}
{% load thumbnail %}

{% block extra_content %}
    <style type="text/css">
        ul li {list-style: none;}
        #ui-datepicker-div {display: none;}
    </style>
    
    <form id="edit-form" enctype="multipart/form-data" action="." class="well" method="post">{% csrf_token %}
        <div class="row">
            <div class="span12">
                <div class="input">{% trans "Avatar:" %}</div>
                <img src="{{ form.instance.avatar|default:'img/default.jpg'|thumbnail_url:'span9_wide' }}" alt="">
                <div {% if form.avatar.errors %}class="control-group error"{% else %}class="input"{% endif %}>{{ form.avatar }}{{ form.avatar.errors }}</div>
                <div {% if form.name.errors %}class="control-group error"{% else %}class="input"{% endif %}>{{ form.name }}{{ form.name.errors }}</div> 
                <div {% if form.description.errors %}class="control-group error"{% else %}class="input"{% endif %}>{{ form.description }}</div> 
                <div {% if form.location.errors %}class="control-group error"{% else %}class="input"{% endif %}>{{ form.location }}</div> 
                <div {% if form.duration.errors %}class="control-group error"{% else %}class="input"{% endif %}>{% trans "Duration" %} {{ form.duration }}</div> 
                <div class="input">{% trans "Contact person:" %}</div>
                <div {% if form.contact.errors %}class="text-error"{% else %}class="input"{% endif %}>{{ form.contact }}{{ form.contact.errors }}</div> 
                <div {% if form.alt_person_fullname.errors %}class="control-group error"{% else %}class="input"{% endif %}>{{ form.alt_person_fullname }}{{ form.alt_person_fullname.errors }}</div> 
                <div {% if form.alt_person_email.errors %}class="control-group error"{% else %}class="input"{% endif %}>{{ form.alt_person_email }}{{ form.alt_person_email.errors }}</div> 
                <div {% if form.alt_person_phone.errors %}class="control-group error"{% else %}class="input"{% endif %}>{{ form.alt_person_phone }}{{ form.alt_person_phone.errors }}</div> 
                <div {% if form.start_date.errors or form.start_time.errors %}class="control-group error"{% else %}class="input"{% endif %}>{% trans "Start date" %} {{ form.start_date }}{{ form.start_date.errors }} {% trans "Time" %} {{ form.start_time }}{{ form.start_time.errors }}</div>
                <div {% if form.application.errors %}class="text-error"{% else %}class="input"{% endif %}>{% trans "Application" %} {{ form.application }}</div> 
                <input id="save" name="save" type="submit" class="btn btn-primary" value="{% trans 'Save Changes' %}" />
                <input id="delete-btn" name="delete-btn" type="button" class="btn btn-danger " value="{% trans 'Delete challenge' %}">
                <div id="delete-form">
                    <div class="input">{{ form.deleted_reason }}</div>
                    <div><input id="delete" name="delete" type="button" class="btn btn-primary" value="{% trans 'Delete' %}" /><input id="cancel-btn" name="cancel-btn" type="button" class="btn" value="{% trans 'Cancel' %}"></div>
                </div>
            </div>
        </div>     
    </form>

    <div id="dialog">
        <span>Do you really want to delete this challenge?</span>
    </div>
    
    <script>
        $(function() {
            options = {
                dateFormat: 'dd.mm.yy',
                changeYear: true,
                yearRange: ":+2",
                changeMonth: true
            }
            $('input[name=start_date]').datepicker(options);
        });

        $("#id_deleted_reason").keyup(function() {
            if (this.value.length >= 20){
                $('input[id="delete"]').removeAttr('disabled');
                $('input[id="delete"]').attr('class','btn-primary');
            } else {
                $('input[id="delete"]').attr('disabled','disabled');
                $('input[id="delete"]').attr('class','btn');
            }
        });

        $(document).ready(function(){
            $('input[id="delete"]').attr('disabled','disabled');
            $('input[id="delete"]').attr('class','btn');

            $("#delete-form").hide();
            $("#delete-btn").click(function(){
                $("#delete-btn").hide();
                $('#delete-form').show("slow");
                return false;
            });
            $("#cancel-btn").click(function(){
                $('#delete-form').hide("slow");
                $("#delete-btn").show("slow");
                return false;
            });

            //Delete confirmation dialog window
            $("#dialog").dialog({
                autoOpen: false,
                draggable: true,
                resizable: false,
                modal: true,
                buttons: {
                    "Delete": function(){
                        var input = $("<input>").attr("type", "hidden").attr("name", "delete").val("delete");
                        $("#edit-form").append($(input));
                        $("#edit-form").submit();   
                    },
                    "Close": function(){
                        $(this).dialog('close');   
                    }
                }
            });

            $('input[id="delete"]').click(function(){
                $("#dialog").dialog("open");
            });
        });
    </script>
{% endblock %}
